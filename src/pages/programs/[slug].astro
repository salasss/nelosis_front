---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import Button from "../../components/Button.astro";
import Icon from "../../components/Icon.astro";
import projects from "../../data/projects.json";

export async function getStaticPaths() {
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
---

<BaseLayout
  title={`${project.title} - Nélosis`}
  description={project.description}
>
  <Header />

  <main class="bg-dark min-h-screen">
    <!-- Hero Section -->
    <section
      class="relative h-[60vh] md:h-[80vh] flex items-center justify-center overflow-hidden"
    >
      <!-- Dynamic Background -->
      <div class="absolute inset-0 z-0">
        <div class="absolute inset-0 bg-dark-secondary/80 z-10"></div>
        <div
          class="absolute top-[-50%] left-[-50%] w-[200%] h-[200%] animate-[spin_60s_linear_infinite]"
          style={`background: radial-gradient(circle at 50% 50%, ${project.color}, transparent 70%); opacity: 0.2;`}
        >
        </div>
      </div>

      <div class="container mx-auto px-6 relative z-20 text-center fade-in-up">
        <div
          class="inline-block px-4 py-2 rounded-full border border-white/10 bg-white/5 backdrop-blur-sm mb-6"
        >
          <span
            class="text-sm font-bold tracking-wider uppercase"
            style={`color: ${project.color}`}>{project.category}</span
          >
        </div>

        <h1
          class="text-5xl md:text-7xl lg:text-8xl font-display font-bold text-white mb-6 leading-tight"
        >
          {project.title}
        </h1>

        <p
          class="text-xl md:text-2xl text-text-muted max-w-2xl mx-auto font-light"
        >
          {project.subtitle}
        </p>
      </div>
    </section>

    <!-- Content Sections -->
    <section class="py-24 relative z-10">
      <div class="container mx-auto px-6 max-w-5xl">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-12 mb-24">
          <div class="md:col-span-4 fade-in-up">
            <div class="sticky top-32">
              <div
                class="w-20 h-20 rounded-2xl flex items-center justify-center mb-6"
                style={`background-color: ${project.color}20; color: ${project.color}`}
              >
                <Icon name={project.icon} class="w-10 h-10" />
              </div>
              <h3 class="text-white font-bold text-xl mb-4">À propos</h3>
              <p class="text-text-muted leading-relaxed">
                {project.description}
              </p>
            </div>
          </div>

          <div class="md:col-span-8 space-y-16">
            {
              project.content?.map((section, index) => (
                <div
                  class="fade-in-up"
                  style={`transition-delay: ${index * 100}ms`}
                >
                  <h2 class="text-3xl md:text-4xl font-display font-bold text-white mb-6">
                    {section.title}
                  </h2>
                  <div class="prose prose-invert prose-lg text-text-muted leading-loose">
                    <p>{section.text}</p>
                  </div>

                  {/* Visual Section */}
                  {section.image && (
                    <div class="mt-8 w-full h-80 rounded-2xl overflow-hidden relative group border border-white/5">
                      <div class="absolute inset-0 bg-gradient-to-t from-dark to-transparent opacity-50 z-10" />
                      <img
                        src={section.image}
                        alt={section.title}
                        class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700 ease-out"
                      />
                    </div>
                  )}
                </div>
              ))
            }
          </div>
        </div>

        <!-- Navigation -->
        <div
          class="border-t border-white/5 pt-12 flex justify-between items-center fade-in-up"
        >
          <Button href="/#programs" variant="outline"
            >Retour aux programmes</Button
          >
          <Button href="#contact" variant="primary">Soutenir ce projet</Button>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>

<script>
  // Re-use intersection observer logic if needed, or rely on global script if present
  const observerOptions = {
    root: null,
    rootMargin: "0px",
    threshold: 0.1,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add("visible");
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll(".fade-in-up").forEach((el) => {
    observer.observe(el);
  });
</script>

<style>
  .fade-in-up {
    opacity: 0;
    transform: translateY(30px);
    transition:
      opacity 0.8s ease-out,
      transform 0.8s ease-out;
  }

  .fade-in-up.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>
